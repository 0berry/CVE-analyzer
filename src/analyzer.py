#!/usr/bin/env python

# import ipdb
import numpy as np
import en_core_web_sm
from spacy import displacy

PATH_TO_DATASET = '../dataset/cve_linux_kernel_2018_simplified.csv'
DATASET_FIELDS = [
    'CVE ID', 'CWE ID', 'Vulnerability Type(s)', 'Avail.'
]


def _load_dataset(path_to_dataset):
    return np.genfromtxt(
        path_to_dataset,
        dtype="S1024, i8, S1024, S1024, S1024, S1024, S1024",
        delimiter=';',
        skip_header=1,
        names=DATASET_FIELDS,
    )


def POS_tagging(model, dataset):
    for doc in dataset:
        cve_description = doc[-1]
        tagged_doc = model(cve_description.decode('utf-8'))
        sentences = [sentence.string.strip() for sentence in tagged_doc.sents]
        for sentence in sentences:
            tagged_sentence = model(sentence)
            displacy.serve(tagged_doc, style='dep', port=1337)
            import ipdb
            ipdb.set_trace()


def main():
    model = en_core_web_sm.load()
    dataset = _load_dataset(PATH_TO_DATASET)
    POS_tagging(model, dataset)


if __name__ == '__main__':
    main()
